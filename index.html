<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagniStyle - Badge Template Creator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-container">
                <img src="MagniStyle.svg" alt="MagniStyle - Badge Template Creator" class="brand-logo">
            </div>
            <p>Create professional badge templates with custom adjustments</p>
        </header>

        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button id="singleModeTab" class="tab-btn">Single Badge</button>
            <button id="gridModeTab" class="tab-btn active">A4 Grid (12 Badges)</button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Single Badge Mode -->
            <div id="singleMode" class="mode-content hidden">
                <div class="workspace">
                    <!-- Upload Section -->
                    <div class="upload-section">
                        <div id="dropZone" class="drop-zone">
                            <div class="drop-zone-content">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                </svg>
                                <h3>Drop your image here</h3>
                                <p>or click to browse</p>
                                <input type="file" id="imageInput" accept="image/*" hidden>
                            </div>
                        </div>
                    </div>

                    <!-- Canvas Section -->
                    <div class="canvas-section">
                        <div class="canvas-container">
                            <canvas id="mainCanvas" width="800" height="600"></canvas>
                            <div id="cropOverlay" class="crop-overlay hidden">
                                <div class="crop-box">
                                    <div class="crop-handle top-left"></div>
                                    <div class="crop-handle top-right"></div>
                                    <div class="crop-handle bottom-left"></div>
                                    <div class="crop-handle bottom-right"></div>
                                    <div class="crop-handle top"></div>
                                    <div class="crop-handle bottom"></div>
                                    <div class="crop-handle left"></div>
                                    <div class="crop-handle right"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Single Mode Controls Panel -->
                <aside class="controls-panel">
                    <div class="control-group compact">
                        <h3>Image Adjustments</h3>
                        
                        <div class="adjustments-grid">
                            <div class="control-item">
                                <label for="brightness">Brightness</label>
                                <input type="range" id="brightness" min="-100" max="100" value="0" step="1">
                                <span class="value-display">0</span>
                            </div>

                            <div class="control-item">
                                <label for="contrast">Contrast</label>
                                <input type="range" id="contrast" min="-100" max="100" value="0" step="1">
                                <span class="value-display">0</span>
                            </div>

                            <div class="control-item">
                                <label for="saturation">Saturation</label>
                                <input type="range" id="saturation" min="-100" max="100" value="0" step="1">
                                <span class="value-display">0</span>
                            </div>

                            <div class="control-item">
                                <label for="cornerRadius">Corner Radius</label>
                                <input type="range" id="cornerRadius" min="0" max="50" value="8" step="1">
                                <span class="value-display">8px</span>
                            </div>
                        </div>

                        <div class="control-item">
                            <label for="badgeMargin">Badge Margin</label>
                            <input type="range" id="badgeMargin" min="0" max="15" value="3" step="0.5">
                            <span class="value-display">3mm</span>
                        </div>
                    </div>

                    <div class="control-group compact" id="cropGroup">
                        <h3>Crop Controls</h3>
                        <div class="crop-controls-compact">
                            <div class="crop-grid">
                                <div class="crop-cell crop-top">
                                    <label for="singleCropTop" title="Top">↑</label>
                                    <input type="range" id="singleCropTop" min="0" max="50" value="0" step="1" orient="vertical">
                                    <span class="value-display">0%</span>
                                </div>
                                <div class="crop-cell crop-left">
                                    <label for="singleCropLeft" title="Left">←</label>
                                    <input type="range" id="singleCropLeft" min="0" max="50" value="0" step="1">
                                    <span class="value-display">0%</span>
                                </div>
                                <div class="crop-center">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <rect x="3" y="3" width="18" height="18" stroke-width="2" stroke-dasharray="2 2"/>
                                        <path d="M8 8 L16 16 M16 8 L8 16" stroke-width="1" opacity="0.5"/>
                                    </svg>
                                </div>
                                <div class="crop-cell crop-right">
                                    <label for="singleCropRight" title="Right">→</label>
                                    <input type="range" id="singleCropRight" min="0" max="50" value="0" step="1">
                                    <span class="value-display">0%</span>
                                </div>
                                <div class="crop-cell crop-bottom">
                                    <label for="singleCropBottom" title="Bottom">↓</label>
                                    <input type="range" id="singleCropBottom" min="0" max="50" value="0" step="1" orient="vertical">
                                    <span class="value-display">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="button-group single-column">
                            <button id="resetCrop" class="btn btn-secondary">Reset Crop</button>
                        </div>
                    </div>

                    <div class="control-group compact">
                        <h3>Template Options</h3>
                        <div class="control-item">
                            <label for="templateOpacity">Template Opacity</label>
                            <input type="range" id="templateOpacity" min="0" max="100" value="30" step="1">
                            <span class="value-display">30%</span>
                        </div>
                        
                        <div class="checkbox-item compact">
                            <input type="checkbox" id="showGuides" checked>
                            <label for="showGuides">Show Cut Guides</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Export</h3>
                        <div class="export-info">
                            <p><strong>Print Settings:</strong></p>
                            <ul>
                                <li>Resolution: 300 DPI</li>
                                <li>Color: CMYK</li>
                                <li id="exportSize">Size: 66×66mm (with margin)</li>
                            </ul>
                        </div>
                        <div class="button-group single-column">
                            <button id="previewPDF" class="btn btn-secondary btn-large" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                <span>Preview PDF</span>
                            </button>
                            <button id="downloadPDF" class="btn btn-primary btn-large" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                                </svg>
                                <span id="downloadText">Download PDF</span>
                            </button>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- A4 Grid Mode -->
            <div id="gridMode" class="mode-content">
                <div class="grid-workspace">
                    <!-- Left Side: Adjustments Panel -->
                    <aside class="grid-adjustments-panel" id="gridAdjustmentsPanel">
                        <div class="panel-header">
                            <h3>Image Adjustments</h3>
                            <button id="toggleAdjustmentsPanel" class="toggle-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                        <div class="panel-content">
                            <div class="adjustments-grid">
                                <div class="control-item">
                                    <label for="gridBrightness">Brightness</label>
                                    <input type="range" id="gridBrightness" min="-100" max="100" value="0" step="1">
                                    <span class="value-display">0</span>
                                </div>

                                <div class="control-item">
                                    <label for="gridContrast">Contrast</label>
                                    <input type="range" id="gridContrast" min="-100" max="100" value="0" step="1">
                                    <span class="value-display">0</span>
                                </div>

                                <div class="control-item">
                                    <label for="gridSaturation">Saturation</label>
                                    <input type="range" id="gridSaturation" min="-100" max="100" value="0" step="1">
                                    <span class="value-display">0</span>
                                </div>

                                <div class="control-item">
                                    <label for="gridCornerRadius">Corner Radius</label>
                                    <input type="range" id="gridCornerRadius" min="0" max="50" value="8" step="1">
                                    <span class="value-display">8px</span>
                                </div>
                            </div>

                            <div class="control-item">
                                <label for="gridBadgeMargin">Badge Margin</label>
                                <input type="range" id="gridBadgeMargin" min="0" max="15" value="3" step="0.5">
                                <span class="value-display">3mm</span>
                            </div>

                            <div class="button-group single-column">
                                <button id="gridResetAdjustments" class="btn btn-secondary">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    <span>Reset Adjustments</span>
                                </button>
                            </div>
                        </div>
                    </aside>

                    <!-- Center: Grid Content -->
                    <div class="grid-content">
                        <!-- Grid Upload Section -->
                        <div class="grid-upload-section">
                            <div id="gridDropZone" class="drop-zone enhanced-drop-zone">
                                <div class="drop-zone-content">
                                    <div class="upload-icon-container">
                                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                        </svg>
                                        <div class="upload-pulse"></div>
                                    </div>
                                    <h3>Drop images here or click to browse</h3>
                                    <p>Add images to the next available slot</p>
                                    <div class="upload-stats">
                                        <span class="stat-item">
                                            <span class="stat-number" id="filledSlots">0</span>
                                            <span class="stat-label">Filled</span>
                                        </span>
                                        <span class="stat-divider">•</span>
                                        <span class="stat-item">
                                            <span class="stat-number" id="emptySlots">12</span>
                                            <span class="stat-label">Available</span>
                                        </span>
                                    </div>
                                    <input type="file" id="gridImageInput" accept="image/*" multiple hidden>
                                </div>
                            </div>

                            <!-- A4 Grid Layout -->
                            <div class="a4-grid-container">
                                <div class="a4-grid-header">
                                    <div class="grid-header-info">
                                        <div class="grid-title-section">
                                            <h3>A4 Sheet Layout</h3>
                                            <span class="grid-dimensions">210×297mm</span>
                                        </div>
                                        <p class="grid-instructions">
                                            <span class="instruction-item">Click to select</span>
                                            <span class="instruction-separator">•</span>
                                            <span class="instruction-item"><kbd>⌘</kbd>+Click for multi-select</span>
                                            <span class="instruction-separator">•</span>
                                            <span class="instruction-item">Adjustments apply in real-time</span>
                                        </p>
                                    </div>
                                    <div class="grid-controls">
                                        <div class="control-group">
                                            <button id="selectAllSlots" class="btn btn-primary">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                                Select All
                                            </button>
                                            <button id="deselectAllSlots" class="btn btn-secondary">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                                Deselect All
                                            </button>
                                        </div>
                                        <div class="control-group">
                                            <button id="fillEmptySlots" class="btn btn-accent">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                                </svg>
                                                Fill Empty
                                            </button>
                                            <button id="clearAllSlots" class="btn btn-danger">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                                </svg>
                                                Clear All
                                            </button>
                                        </div>
                                        <div class="selection-info enhanced-selection-info">
                                            <div class="selection-badge">
                                                <span class="selection-count" id="selectionCount">0</span>
                                                <span class="selection-label">selected</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="a4-grid" id="a4Grid">
                                    <!-- Grid slots will be generated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Preview & Controls Panel -->
                    <aside class="grid-controls-panel" id="gridControlsPanel">
                        <div class="panel-header">
                            <h3>Preview & Controls</h3>
                            <button id="togglePanel" class="toggle-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                        <div class="panel-content">
                            <!-- Individual Image Preview -->
                            <div class="control-group compact">
                                <h3>Selected Image Preview</h3>
                                <div class="image-preview-container">
                                    <canvas id="gridImagePreview" width="200" height="200"></canvas>
                                    <div class="preview-info">
                                        <p id="previewSlotInfo">No image selected</p>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group compact">
                                <h3>Image Transform</h3>
                                
                                <!-- Primary Controls (Always Visible) -->
                                <div class="control-item">
                                    <label for="imageScale">Scale</label>
                                    <div class="scale-control">
                                        <button class="scale-btn" id="scaleDown">-</button>
                                        <input type="range" id="imageScale" min="10" max="500" value="100" step="5">
                                        <button class="scale-btn" id="scaleUp">+</button>
                                        <span class="value-display">100%</span>
                                    </div>
                                </div>
                                
                                <div class="control-item">
                                    <label>Position</label>
                                    <div class="position-control">
                                        <div class="position-row">
                                            <button class="pos-btn" id="moveUp" title="Move Up">↑</button>
                                        </div>
                                        <div class="position-row">
                                            <button class="pos-btn" id="moveLeft" title="Move Left">←</button>
                                            <div class="center-indicator">●</div>
                                            <button class="pos-btn" id="moveRight" title="Move Right">→</button>
                                        </div>
                                        <div class="position-row">
                                            <button class="pos-btn" id="moveDown" title="Move Down">↓</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Collapsible: Rotation & Flip -->
                                <div class="collapsible-section">
                                    <button class="collapsible-header" data-target="rotationFlipSection">
                                        <span>Rotation & Flip</span>
                                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    <div class="collapsible-content" id="rotationFlipSection">
                                        <div class="control-item">
                                            <label for="imageRotation">Rotation</label>
                                            <div class="rotation-control">
                                                <button class="rotation-btn" id="rotateLeft" title="Rotate Left">↶</button>
                                                <div class="rotation-wheel">
                                                    <div class="rotation-indicator" id="rotationIndicator">●</div>
                                                    <input type="range" id="imageRotation" min="-180" max="180" value="0" step="5" class="rotation-slider">
                                                </div>
                                                <button class="rotation-btn" id="rotateRight" title="Rotate Right">↷</button>
                                                <span class="value-display">0°</span>
                                            </div>
                                        </div>
                                        
                                        <div class="control-item">
                                            <label>Flip</label>
                                            <div class="flip-controls">
                                                <button class="flip-btn" id="flipHorizontal" title="Flip Horizontal">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 3H5a2 2 0 00-2 2v14a2 2 0 002 2h3m8-18h3a2 2 0 012 2v14a2 2 0 01-2 2h-3m-4-4l4-4m0 0l4 4m-4-4v12"/>
                                                    </svg>
                                                    <span>Flip H</span>
                                                </button>
                                                <button class="flip-btn" id="flipVertical" title="Flip Vertical">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8V5a2 2 0 012-2h14a2 2 0 012 2v3m0 8v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3m4-4l4 4m0 0l4-4m-4 4H8"/>
                                                    </svg>
                                                    <span>Flip V</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Collapsible: Crop & Zoom -->
                                <div class="collapsible-section">
                                    <button class="collapsible-header" data-target="cropZoomSection">
                                        <span>Crop & Zoom</span>
                                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    <div class="collapsible-content" id="cropZoomSection">
                                        <div class="control-item">
                                            <label for="imageFit">Fit Mode</label>
                                            <div class="fit-mode-controls">
                                                <button class="fit-btn" data-mode="cover" title="Cover (Fill)">Fill</button>
                                                <button class="fit-btn" data-mode="contain" title="Contain (Fit)">Fit</button>
                                                <button class="fit-btn" data-mode="fill" title="Fill (Stretch)">Stretch</button>
                                            </div>
                                        </div>
                                        
                                        <div class="control-item">
                                            <label>Crop/Trim</label>
                                            <div class="crop-controls-compact">
                                                <div class="crop-grid">
                                                    <div class="crop-cell crop-top">
                                                        <label for="cropTop" title="Top">↑</label>
                                                        <input type="range" id="cropTop" min="0" max="50" value="0" step="1" orient="vertical">
                                                        <span class="value-display">0%</span>
                                                    </div>
                                                    <div class="crop-cell crop-left">
                                                        <label for="cropLeft" title="Left">←</label>
                                                        <input type="range" id="cropLeft" min="0" max="50" value="0" step="1">
                                                        <span class="value-display">0%</span>
                                                    </div>
                                                    <div class="crop-center">
                                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                            <rect x="3" y="3" width="18" height="18" stroke-width="2" stroke-dasharray="2 2"/>
                                                            <path d="M8 8 L16 16 M16 8 L8 16" stroke-width="1" opacity="0.5"/>
                                                        </svg>
                                                    </div>
                                                    <div class="crop-cell crop-right">
                                                        <label for="cropRight" title="Right">→</label>
                                                        <input type="range" id="cropRight" min="0" max="50" value="0" step="1">
                                                        <span class="value-display">0%</span>
                                                    </div>
                                                    <div class="crop-cell crop-bottom">
                                                        <label for="cropBottom" title="Bottom">↓</label>
                                                        <input type="range" id="cropBottom" min="0" max="50" value="0" step="1" orient="vertical">
                                                        <span class="value-display">0%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="control-item">
                                            <label>Fine Zoom</label>
                                            <div class="zoom-controls">
                                                <button class="zoom-btn" id="zoomIn">+</button>
                                                <input type="range" id="fineZoom" min="10" max="500" value="100" step="1">
                                                <button class="zoom-btn" id="zoomOut">-</button>
                                                <span class="value-display">100%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Collapsible: Background Options -->
                                <div class="collapsible-section">
                                    <button class="collapsible-header" data-target="backgroundSection">
                                        <span>Background</span>
                                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                    </button>
                                    <div class="collapsible-content" id="backgroundSection">
                                        <div class="control-item">
                                            <label>Background Options</label>
                                            <div class="background-controls">
                                                <div class="background-mode-controls">
                                                    <button class="bg-btn active" data-mode="color" title="Solid Color">Color</button>
                                                    <button class="bg-btn" data-mode="blur" title="Blurred Image">Blur</button>
                                                </div>
                                                <div class="background-color-control" id="backgroundColorControl">
                                                    <input type="color" id="backgroundColor" value="#ffffff" title="Background Color">
                                                    <span class="color-label">White</span>
                                                </div>
                                                <div class="background-blur-control hidden" id="backgroundBlurControl">
                                                    <input type="range" id="backgroundBlur" min="0" max="20" value="5" step="1">
                                                    <span class="value-display">5px</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="button-group single-column">
                                    <button id="resetImageTransform" class="btn btn-secondary">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                        </svg>
                                        <span>Reset Transform</span>
                                    </button>
                                </div>
                                
                                <div class="button-group single-column">
                                    <button id="applyTransformToSelected" class="btn btn-accent">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                                        </svg>
                                        <span>Apply to Selected</span>
                                    </button>
                                </div>
                            </div>

                            <div class="control-group compact">
                                <h3>Template Options</h3>
                                <div class="control-item">
                                    <label for="gridTemplateOpacity">Template Opacity</label>
                                    <input type="range" id="gridTemplateOpacity" min="0" max="100" value="30" step="1">
                                    <span class="value-display">30%</span>
                                </div>
                                
                                <div class="checkbox-item compact">
                                    <input type="checkbox" id="gridShowGuides" checked>
                                    <label for="gridShowGuides">Show Cut Guides</label>
                                </div>

                                <div class="checkbox-item compact">
                                    <input type="checkbox" id="showGridGuides" checked>
                                    <label for="showGridGuides">Show Grid Guides</label>
                                </div>
                            </div>

                            <div class="control-group">
                                <h3>Export</h3>
                                <div class="export-info">
                                    <p><strong>Print Settings:</strong></p>
                                    <ul>
                                        <li>Resolution: 300 DPI</li>
                                        <li>Color: CMYK</li>
                                        <li id="exportSize">Size: A4 (210×297mm)</li>
                                    </ul>
                                </div>
                                <div class="button-group single-column">
                                    <button id="gridPreviewPDF" class="btn btn-secondary btn-large" disabled>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                        <span>Preview PDF</span>
                                    </button>
                                    <button id="gridDownloadPDF" class="btn btn-primary btn-large" disabled>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                                        </svg>
                                        <span id="gridDownloadText">Download A4 PDF</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>

        </main>


        <!-- Preview Modal -->
        <div id="previewModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title-container">
                        <img src="MagniStyle.svg" alt="MagniStyle Logo" class="modal-logo">
                        <h2>PDF Preview</h2>
                    </div>
                    <button id="closePreview" class="close-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="preview-info">
                        <p id="previewMode">Mode: Single Badge</p>
                        <p id="previewSize">Size: 66×66mm</p>
                        <p id="previewGuides">Guides: Cut guides enabled</p>
                    </div>
                    <div class="preview-canvas-container">
                        <canvas id="previewCanvas" width="800" height="800"></canvas>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="printFromPreview" class="btn btn-secondary btn-large">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                        </svg>
                        <span>Print Preview</span>
                    </button>
                    <button id="downloadFromPreview" class="btn btn-primary btn-large">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                        </svg>
                        <span>Download PDF</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Generating PDF...</p>
            </div>
        </div>
    </div>

    <!-- Original Working Version (ACTIVE) -->
    <script src="app.js"></script>
    
    <!-- Modular Architecture Version (Work in Progress) -->
    <!-- <script type="module" src="js/app-modular.js"></script> -->
</body>
</html>
